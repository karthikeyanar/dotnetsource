!function(b){var e=function(a,d){this.$element=b(a);this.type=this.$element.data("uploadtype")||(0<this.$element.find(".thumbnail").length?"image":"file");this.$input=this.$element.find(":file");if(0!==this.$input.length){this.name=this.$input.attr("name")||d.name;this.$hidden=this.$element.find('input[type=hidden][name="'+this.name+'"]');0===this.$hidden.length&&(this.$hidden=b('<input type="hidden" />'),this.$element.prepend(this.$hidden));this.$preview=this.$element.find(".fileupload-preview");
var c=this.$preview.css("height");"inline"!=this.$preview.css("display")&&"0px"!=c&&"none"!=c&&this.$preview.css("line-height",c);this.original={exists:this.$element.hasClass("fileupload-exists"),preview:this.$preview.html(),hiddenVal:this.$hidden.val()};this.$remove=this.$element.find('[data-dismiss="fileupload"]');this.$element.find('[data-trigger="fileupload"]').on("click.fileupload",b.proxy(this.trigger,this));this.listen()}};e.prototype={listen:function(){this.$input.on("change.fileupload",b.proxy(this.change,
this));b(this.$input[0].form).on("reset.fileupload",b.proxy(this.reset,this));if(this.$remove)this.$remove.on("click.fileupload",b.proxy(this.clear,this))},change:function(a,d){if("clear"!==d){var c=void 0!==a.target.files?a.target.files[0]:a.target.value?{name:a.target.value.replace(/^.+\\/,"")}:null;if(c)if(this.$hidden.val(""),this.$hidden.attr("name",""),this.$input.attr("name",this.name),"image"===this.type&&0<this.$preview.length&&("undefined"!==typeof c.type?c.type.match("image.*"):c.name.match(/\.(gif|png|jpe?g)$/i))&&
"undefined"!==typeof FileReader){var b=new FileReader,e=this.$preview,f=this.$element;b.onload=function(a){e.html('<img src="'+a.target.result+'" '+("none"!=e.css("max-height")?'style="max-height: '+e.css("max-height")+';"':"")+" />");f.addClass("fileupload-exists").removeClass("fileupload-new")};b.readAsDataURL(c)}else this.$preview.text(c.name),this.$element.addClass("fileupload-exists").removeClass("fileupload-new");else this.clear()}},clear:function(a){this.$hidden.val("");this.$hidden.attr("name",
this.name);this.$input.attr("name","");if(navigator.userAgent.match(/msie/i)){var b=this.$input.clone(!0);this.$input.after(b);this.$input.remove();this.$input=b}else this.$input.val("");this.$preview.html("");this.$element.addClass("fileupload-new").removeClass("fileupload-exists");a&&(this.$input.trigger("change",["clear"]),a.preventDefault())},reset:function(a){this.clear();this.$hidden.val(this.original.hiddenVal);this.$preview.html(this.original.preview);this.original.exists?this.$element.addClass("fileupload-exists").removeClass("fileupload-new"):
this.$element.addClass("fileupload-new").removeClass("fileupload-exists")},trigger:function(a){this.$input.trigger("click");a.preventDefault()}};b.fn.fileupload=function(a){return this.each(function(){var d=b(this),c=d.data("fileupload");c||d.data("fileupload",c=new e(this,a));if("string"==typeof a)c[a]()})};b.fn.fileupload.Constructor=e;b(document).on("click.fileupload.data-api",'[data-provides="fileupload"]',function(a){var d=b(this);d.data("fileupload")||(d.fileupload(d.data()),d=b(a.target).closest('[data-dismiss="fileupload"],[data-trigger="fileupload"]'),
0<d.length&&(d.trigger("click.fileupload"),a.preventDefault()))})}(window.jQuery);
